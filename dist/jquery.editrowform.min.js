!function(t,n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof exports?module.exports=n(require("jquery")):n(t.jQuery)}(this,function(t){"use strict";t.fn.editrowform=function(n){var e,o=Array.prototype.slice.call(arguments,1),i=this;return this.each(function(r,u){var a=t(u),s=a.data("editrowform");"string"==typeof n?s&&t.isFunction(s[n])&&(e=s[n].apply(s,o),r||(i=e)):s||(s=new t.editrowform(u,n))}),i},t.editrowform=function(n,e){function o(){if(_.$el.data("editrowform",_),_.options=t.extend({},t.editrowform.defaultOptions,e),H(),_.options.click){var n=t("tr td",_.el).parent();n.dblclick(function(t){i(this)}),n.click(function(t){r(this)})}_.options.hideOnBlur&&t(document).click(function(n){var e=t(n.target).closest(at).length,o=t(n.target).closest(_.el).length;e||o||tt||w(),tt=!1}),t(window).resize(function(){L(dt)}),at.keydown(function(t){if(!_.options.disableArrowKeys){switch(t.which){case 38:u();break;case 40:a();break;default:return}t.preventDefault()}})}function i(n){w(),g(t(n).index())}function r(n){c()&&(w(),g(t(n).index()))}function u(){c()&&g(lt-1)}function a(){c()&&g(lt+1)}function s(){return st}function c(){return!ft.isHidden(at)}function d(){var t=b().saveButtonTimeout;ft.isNotEmpty(t)&&ft.timeoutButton(pt.getSaveButtonId(),t);for(var n,e=!0,o=[],i=0;i<R();i++)n=D(i),o.push(n);var r=b().onSave;ft.functionExists(r)&&(e=r(st,lt,dt,o)),(e||ft.isEmpty(e))&&(h(lt,o),w())}function l(){var t=b().cancelButtonTimeout;ft.isNotEmpty(t)&&ft.timeoutButton(pt.getCancelButtonId(),t);var n=!0,e=b().onCancel;ft.functionExists(e)&&(n=e(st,lt,dt)),(n||ft.isEmpty(n))&&w()}function p(t){var n,e=!0,o=F();n=t!==!0&&!ft.isEmpty(t)||0===o?t===!0||t===!1||ft.isEmpty(t)?v():f(ft.functionExists(t)?t():t):m();var u=b().onAddRow;return ft.functionExists(u)&&(e=u(o,n)),!e&&!ft.isEmpty(e)||ft.isEmpty(n)?!1:(b().click&&(n.dblclick(function(t){i(this)}),n.click(function(t){r(this)})),n.appendTo(_.$el),o)}function f(n){return t(n).clone()}function m(){var n=(F(),N(F()-1)),e=t(n).clone();return e.prop("id",""),t("td",e).each(function(n,e){var o=ut[n];o.ignore||t(this).html("&nbsp;")}),e}function v(){for(var n,e=R(),o=t(vt.tr),i=0;e>i;i++)n=t(vt.td),n.appendTo(o),n.html("&nbsp;");return o}function y(t){if(A(t)){var n=!0,e=N(t),o=b().onDeleteRow;ft.functionExists(o)&&(n=o(t,e)),!n&&!ft.isEmpty(n)||ft.isEmptyArray(e)||e.remove()}}function h(t,n){if(A(t))for(var e=0;e<R();e++)M(e)||P(e)||B(t,e,n[e])}function E(t){tt=!0,g(t)}function g(t){if(A(t)&&null!==at){Z(t);var n=N(t);L(n),S(t),at.show(),Q(),b().focusOnInput&&x(),dt=n,lt=t}}function x(){t("input",at).each(function(n,e){var o=t(e).prop("disabled");return o?void 0:(t(e).focus(),!1)})}function w(){if(null!==at&&c()){at.hide();var t=b().onHide;ft.functionExists(t)&&t(st,lt,dt)}}function I(){_.$el.removeData("editrowform"),at&&(at.remove(),at=null)}function b(){return _.options}function C(){var n=t("thead tr",_.el);return ft.isNotEmpty(n)?n:t("th",_.el).parent()}function k(n){var e,o=C();return ft.isNotEmpty(o)&&(e=t("th",o)[n]),e}function N(n){return t("tbody tr",_.el).eq(n)}function T(n,e){var o,i=N(n);return ft.isNotEmpty(i)&&(o=t("td",i)[e]),o}function V(n,e){var o,i=T(n,e),r=G(e),u=t("input",i);o=ft.isEmptyArray(u)?t(i).text().trim():mt.getValue(u,r);var a=b().getCellValue;return ft.functionExists(a)&&(o=a(n,e,o,N(n),i)),o}function B(n,e,o){var i,r=G(e),u=T(n,e),a=b().setCellValue;ft.functionExists(a)?a(n,e,o,N(n),u):(i=t("input",u),ft.isEmptyArray(i)?t(u).text(o):mt.setValue(i,r,o))}function R(){var n=C();return ft.isEmptyArray(n)?t("td",N(0)).length:t("th",n).length}function F(){return t("tbody tr",_.el).length}function A(t){return ft.isEmpty(t)?!1:isNaN(t)?!1:!(0>t||t>=F())}function S(t){for(var n=0;n<R();n++)O(t,n,V(t,n))}function O(n,e,o){var i,r,u=pt.getInputId(e),a=(N(n),b().setInputValue);ft.functionExists(a)?a(n,e,o,u,st,N(n),T(n,e),k(e)):(i=G(e),r=t("."+et+e,st),mt.setValue(r,i,o))}function D(n){var e,o=t("."+et+n,st);ft.isEmptyArray(o)||(e=mt.getValue(o,G(n)));var i=b().getInputValue;return ft.functionExists(i)&&(e=i(lt,n,e,pt.getInputId(n),st,dt,T(lt,n),k(n))),e}function W(n){if(!P(n)){var e=pt.getInputId(n),o=pt.getInputName(n),i=mt.createInput(e,o,G(n)),r=U(n);ft.isNotEmpty(r)&&i.val(r),M(n)&&i.prop("disabled",!0);var u=b().renderInput;return ft.functionExists(u)&&(i=u(i,lt,n,k(n))),i&&(t(i).addClass(et+n),t(i).addClass(nt+ot)),i}}function H(){$(),j()}function $(){var n,e,o=_.options.columns,i=0,r={};for(i=0;i<R();i++)r[i]=ft.clone(_.options.defaultColumn);if(ft.isNotEmpty(o)&&t.isArray(o))for(i=0;i<o.length;i++)n=o[i],ft.isNotEmpty(n)&&(e=n.colIndex,ft.isEmpty(e)&&(e=i),r[e]=n);ut=r}function j(){var n=t(vt.div);n.prop("id",pt.getEditRowFormId()),n.prop("tabIndex",0),n.addClass(nt),n.addClass(b().cssClass),n.hide(),n.appendTo(document.body);var e=t(vt.form);e.prop("id",pt.getFormId()),e.prop("tabindex",0),e.addClass(nt+"-form"),e.appendTo(n);var o=q();o.appendTo(e);var i=z();i.appendTo(n),e.submit(function(t){t.preventDefault(),d()}),ct=i,at=n,st=e}function q(){var n=t(vt.div);n.prop("id",pt.getFormRowId()),n.addClass("row");for(var e=null,o=0;o<R();o++)e=K(o),e.appendTo(n);return n}function K(n){var e=t(vt.div);e.prop("id",pt.getFormCellId(n)),e.addClass("cell"),e.addClass(it+n);var o=W(n);return o&&o.appendTo(e),e}function z(){var n=t(vt.div),e=t(vt.button);e.prop("id",pt.getSaveButtonId()),e.addClass("save"),e.appendTo(n),e.text(b().saveText),e.on("click",d);var o=t(vt.button);o.prop("id",pt.getCancelButtonId()),o.addClass("cancel"),o.appendTo(n),o.text(b().cancelText),o.on("click",l);var i=t(vt.div);return i.addClass("save-and-cancel-bar"),i.addClass("button-bar"),n.appendTo(i),i}function L(n){if(!ft.isEmpty(n)){var e=t(n).offset();ft.position(at,e.top,e.left)}}function Q(){var n=t(ct).innerWidth(),e=_.$el.innerWidth(),o=(e-n)/2;ct.css({left:o,position:"absolute"})}function G(n){var e=ut[n].type;return"datepicker"!==e||t.datepicker?ft.isNotEmpty(e)?e:J(n):rt}function J(n){var e=T(0,n),o=t("input, select, textarea",e).prop("type");return ft.isNotEmpty(o)&&-1!=o.indexOf("select")?"select":ft.isNotEmpty(o)?o:rt}function M(t){var n=ut[t].disabled;return ft.isNotEmpty(n)?ft.toBoolean(n):!1}function P(t){var n=ut[t].ignore;return ft.isNotEmpty(n)?ft.toBoolean(n):!1}function U(t){return ut[t].defaultValue}function X(n){var e=k(n);if(ft.isNotEmpty(e))return t(e).outerWidth();var o=T(lt,n);return ft.isNotEmpty(o)?t(o).outerWidth():0}function Y(n){var e=N(n);return ft.isNotEmpty(e)?t(e).outerHeight():0}function Z(n){at.width(ft.getWidth(_.el));var e=Y(n);t(".row",at).height(e),t(".row .cell",at).height(e);for(var o=0;o<R();o++){var i=t("."+it+o,at),r=X(o);i.width(r)}}var _=this;_.$el=t(n),_.el=n,_.save=d,_.addRow=p,_.deleteRow=y,_.setRowValues=h,_.show=E,_.hide=w,_.destroy=I,_.getRowCount=F,_.getColumnCount=R,_.getForm=s;var tt,nt="erf",et="input-",ot="-input",it="cell-",rt="text",ut={},at=null,st=null,ct=null,dt=null,lt=null,pt={idSuffix:"-erf",getEditRowFormId:function(t){var n=_.options.id;return ft.isEmpty(n)&&(n=_.el.id),ft.isEmpty(n)&&(n="no-id-"+(new Date).getTime()),n+this.idSuffix},getInputId:function(t){var n=ut[t].id;return ft.isNotEmpty(n)?n:this.getEditRowFormId()+ot+t},getInputName:function(n){var e=ut[n].name;if(ft.isNotEmpty(e))return e;if(e=ut[n].id,ft.isNotEmpty(e))return e;var o=k(n);return e=t(o).text().trim(),ft.isNotEmpty(e)?e:this.getEditRowFormId()+ot+n},getFormCellId:function(t){return this.getEditRowFormId()+"-cell-"+t},getFormRowId:function(){return this.getEditRowFormId()+"-row"},getFormId:function(){return this.getEditRowFormId()+"-form"},getSaveButtonId:function(){return this.getEditRowFormId()+"-save"},getCancelButtonId:function(){return this.getEditRowFormId()+"-cancel"}},ft={timeoutButton:function(n,e){e||(e=1e3);var o="#"+n;t(o).prop("disabled",!0),setTimeout(function(){t(o).prop("disabled",!1)},e)},functionExists:function(n){return"undefined"!=typeof n&&t.isFunction(n)},isEmptyArray:function(t){return this.isEmpty(t)?!0:"undefined"!=typeof t.length?0===t.length:!0},isEmpty:function(n){return void 0===n||null===n||"undefined"==typeof n||"null"==t.trim(n)||""===t.trim(n)},isNotEmpty:function(t){return!this.isEmpty(t)},getWidth:function(n){return t(n).width()},clone:function(n){return t.extend(!0,{},n)},isHidden:function(n){return"none"==t(n).css("display")},position:function(n,e,o){t(n).css({top:e,left:o})},toBoolean:function(t){return this.isEmpty(t)?!1:t===!0||t===!1?t:(t=t.toLowerCase(),"y"==t||"true"==t||"yes"==t||"1"==t)}},mt={createInput:function(n,e,o){var i;return"checkbox"==o?(i=t(vt.checkbox),i.prop("id",n),i.prop("name",e)):"datepicker"==o?(i=t(vt.textfield),i.prop("id",n),i.prop("name",e),t(i).datepicker()):(i=t(vt.textfield),i.prop("id",n),i.prop("name",e)),i},getValue:function(n,e){return"checkbox"==e?this.getCheckboxValue(n):t(n).val()},setValue:function(n,e,o){"checkbox"==e?this.setCheckboxValue(n,o):t(n).val(o)},getCheckboxValue:function(n){return t(n).prop("checked")},setCheckboxValue:function(n,e){t(n).prop("checked",ft.toBoolean(e))}},vt={table:"<table />",tr:"<tr />",td:"<td />",div:"<div />",form:"<form />",button:"<button />",textfield:'<input type="text" />',checkbox:'<input type="checkbox" />'};o()},t.editrowform.defaultOptions={id:"",cssClass:"",click:!0,saveText:"Save",cancelText:"Cancel",saveButtonTimeout:"",cancelButtonTimeout:"",hideOnBlur:!0,focusOnInput:!1,disableArrowKeys:!1,columns:"",defaultColumn:{colIndex:"",id:"",name:"",type:"",disabled:"",ignore:"",defaultValue:""},onSave:"",onCancel:"",onHide:"",onDeleteRow:"",onAddRow:"",getCellValue:"",setCellValue:"",getInputValue:"",setInputValue:"",renderInput:""}});