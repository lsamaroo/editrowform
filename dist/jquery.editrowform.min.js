"use strict";!function(t,n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof module&&module.exports?module.exports=n(require("jquery")):n(t.jQuery)}(this,function(t){t.fn.editrowform=function(n){var e,o=Array.prototype.slice.call(arguments,1),i=this;return this.each(function(r,u){var a=t(u),c=a.data("editrowform");"string"==typeof n?c&&t.isFunction(c[n])&&(e=c[n].apply(c,o),r||(i=e)):c||new t.editrowform(u,n)}),i},t.editrowform=function(n,e){function o(){if(tt.options=t.extend({},t.editrowform.defaultOptions,e),j(),tt.options.click){var n=t("tr td",tt.el).parent();n.dblclick(function(){r(this)}),n.click(function(){u(this)})}tt.options.hideOnBlur&&t(document).click(function(n){var e=t(n.target).closest(ct).length,o=t(n.target).closest(tt.el).length;e||o||nt||I(),nt=!1}),t(window).resize(function(){Q(lt)}),ct.keydown(function(t){i(t)})}function i(t){if(!tt.options.disableArrowKeys){switch(t.which){case 38:a();break;case 40:c();break;default:return}t.preventDefault()}}function r(n){I(),x(t(n).index())}function u(n){d()&&(I(),x(t(n).index()))}function a(){d()&&x(pt-1)}function c(){d()&&x(pt+1)}function s(){return st}function d(){return!mt.isHidden(ct)}function l(){var t=C().saveButtonTimeout;mt.isNotEmpty(t)&&mt.timeoutButton(vt.getSaveButtonId(),t);for(var n,e=!0,o=[],i=0;i<F();i++)n=$(i),o.push(n);var r=C().onSave;mt.functionExists(r)&&(e=r(st,pt,lt,o)),(e||mt.isEmpty(e))&&(E(pt,o),I())}function p(){var t=C().cancelButtonTimeout;mt.isNotEmpty(t)&&mt.timeoutButton(vt.getCancelButtonId(),t);var n=!0,e=C().onCancel;mt.functionExists(e)&&(n=e(st,pt,lt)),(n||mt.isEmpty(n))&&I()}function f(t){var n,e=!0,o=A();n=t!==!0&&!mt.isEmpty(t)||0===o?t===!0||t===!1||mt.isEmpty(t)?y():m(mt.functionExists(t)?t():t):v();var i=C().onAddRow;return mt.functionExists(i)&&(e=i(o,n)),!e&&!mt.isEmpty(e)||mt.isEmpty(n)?!1:(C().click&&(n.dblclick(function(){r(this)}),n.click(function(){u(this)})),n.appendTo(tt.$el),o)}function m(n){return t(n).clone()}function v(){var n=T(A()-1),e=t(n).clone();return e.prop("id",""),t("td",e).each(function(n){var e=at[n];e.ignore||t(this).html("&nbsp;")}),e}function y(){for(var n,e=F(),o=t(ft.tr),i=0;e>i;i++)n=t(ft.td),n.appendTo(o),n.html("&nbsp;");return o}function h(t){if(S(t)){var n=!0,e=T(t),o=C().onDeleteRow;mt.functionExists(o)&&(n=o(t,e)),!n&&!mt.isEmpty(n)||mt.isEmptyArray(e)||e.remove()}}function E(t,n){if(S(t))for(var e=0;e<F();e++)P(e)||U(e)||R(t,e,n[e])}function g(t){nt=!0,x(t)}function x(t){if(S(t)&&null!==ct){_(t);var n=T(t);Q(n),O(t),ct.show(),G(),C().focusOnInput&&w(),lt=n,pt=t}}function w(){t("input",ct).each(function(n,e){var o=t(e).prop("disabled");return o?void 0:(t(e).focus(),!1)})}function I(){if(null!==ct&&d()){ct.hide();var t=C().onHide;mt.functionExists(t)&&t(st,pt,lt)}}function b(){tt.$el.removeData("editrowform"),ct&&(ct.remove(),ct=null)}function C(){return tt.options}function k(){var n=t("thead tr",tt.el);return mt.isNotEmpty(n)?n:t("th",tt.el).parent()}function N(n){var e,o=k();return mt.isNotEmpty(o)&&(e=t("th",o)[n]),e}function T(n){return t("tbody tr",tt.el).eq(n)}function V(n,e){var o,i=T(n);return mt.isNotEmpty(i)&&(o=t("td",i)[e]),o}function B(n,e){var o,i=V(n,e),r=J(e),u=t("input",i);o=mt.isEmptyArray(u)?t(i).text().trim():yt.getValue(u,r);var a=C().getCellValue;return mt.functionExists(a)&&(o=a(n,e,o,T(n),i)),o}function R(n,e,o){var i,r=J(e),u=V(n,e),a=C().setCellValue;mt.functionExists(a)?a(n,e,o,T(n),u):(i=t("input",u),mt.isEmptyArray(i)?t(u).text(o):yt.setValue(i,r,o))}function F(){var n=k();return mt.isEmptyArray(n)?t("td",T(0)).length:t("th",n).length}function A(){return t("tbody tr",tt.el).length}function S(t){return mt.isEmpty(t)?!1:isNaN(t)?!1:!(0>t||t>=A())}function O(t){for(var n=0;n<F();n++)D(t,n,B(t,n))}function D(n,e,o){var i,r,u=vt.getInputId(e),a=C().setInputValue;mt.functionExists(a)?a(n,e,o,u,st,T(n),V(n,e),N(e)):(i=J(e),r=t("."+ot+e,st),yt.setValue(r,i,o))}function $(n){var e,o=t("."+ot+n,st);mt.isEmptyArray(o)||(e=yt.getValue(o,J(n)));var i=C().getInputValue;return mt.functionExists(i)&&(e=i(pt,n,e,vt.getInputId(n),st,lt,V(pt,n),N(n))),e}function H(n){if(!U(n)){var e=vt.getInputId(n),o=vt.getInputName(n),i=yt.createInput(e,o,J(n)),r=X(n);mt.isNotEmpty(r)&&i.val(r),P(n)&&i.prop("disabled",!0);var u=C().renderInput;return mt.functionExists(u)&&(i=u(i,pt,n,N(n))),i&&(t(i).addClass(ot+n),t(i).addClass(et+it)),i}}function j(){q(),W()}function q(){var n,e,o,i=tt.options.columns,r={};for(n=0;n<F();n++)r[n]=mt.clone(tt.options.defaultColumn);if(mt.isNotEmpty(i)&&t.isArray(i))for(n=0;n<i.length;n++)o=n,e=i[n],mt.isNotEmpty(e)&&e.colIndex&&(o=e.colIndex),r[o]=e;at=r}function W(){var n=t(ft.div);n.prop("id",vt.getEditRowFormId()),n.prop("tabIndex",0),n.addClass(et),n.addClass(C().cssClass),n.hide(),n.appendTo(document.body);var e=t(ft.form);e.prop("id",vt.getFormId()),e.prop("tabindex",0),e.addClass(et+"-form"),e.appendTo(n);var o=K();o.appendTo(e);var i=L();i.appendTo(n),e.submit(function(t){t.preventDefault(),l()}),dt=i,ct=n,st=e}function K(){var n=t(ft.div);n.prop("id",vt.getFormRowId()),n.addClass("row");for(var e=0;e<F();e++){var o=z(e);o.appendTo(n)}return n}function z(n){var e=t(ft.div);e.prop("id",vt.getFormCellId(n)),e.addClass("cell"),e.addClass(rt+n);var o=H(n);return o&&o.appendTo(e),e}function L(){var n=t(ft.div),e=t(ft.button);e.prop("id",vt.getSaveButtonId()),e.addClass("save"),e.appendTo(n),e.text(C().saveText),e.on("click",l);var o=t(ft.button);o.prop("id",vt.getCancelButtonId()),o.addClass("cancel"),o.appendTo(n),o.text(C().cancelText),o.on("click",p);var i=t(ft.div);return i.addClass("save-and-cancel-bar"),i.addClass("button-bar"),n.appendTo(i),i}function Q(n){if(!mt.isEmpty(n)){var e=t(n).offset();mt.position(ct,e.top,e.left)}}function G(){var n=t(dt).innerWidth(),e=tt.$el.innerWidth(),o=(e-n)/2;dt.css({left:o,position:"absolute"})}function J(n){var e=at[n].type;return"datepicker"!==e||t.datepicker?mt.isNotEmpty(e)?e:M(n):ut}function M(n){var e=V(0,n),o=t("input, select, textarea",e).prop("type");return mt.isNotEmpty(o)&&-1!==o.indexOf("select")?"select":mt.isNotEmpty(o)?o:ut}function P(t){var n=at[t].disabled;return mt.isNotEmpty(n)?mt.toBoolean(n):!1}function U(t){var n=at[t].ignore;return mt.isNotEmpty(n)?mt.toBoolean(n):!1}function X(t){return at[t].defaultValue}function Y(n){var e=N(n);if(mt.isNotEmpty(e))return t(e).outerWidth();var o=V(pt,n);return mt.isNotEmpty(o)?t(o).outerWidth():0}function Z(n){var e=T(n);return mt.isNotEmpty(e)?t(e).outerHeight():0}function _(n){ct.width(tt.$el.width());var e=Z(n);t(".row",ct).height(e),t(".row .cell",ct).height(e);for(var o=0;o<F();o++){var i=t("."+rt+o,ct),r=Y(o);i.width(r)}}var tt=this;tt.$el=t(n),tt.el=n,tt.$el.data("editrowform",tt);var nt,et="erf",ot="input-",it="-input",rt="cell-",ut="text",at={},ct=null,st=null,dt=null,lt=null,pt=null,ft={table:"<table />",tr:"<tr />",td:"<td />",div:"<div />",form:"<form />",button:"<button />",textfield:'<input type="text" />',checkbox:'<input type="checkbox" />'},mt={timeoutButton:function(n,e){e||(e=1e3);var o="#"+n;t(o).prop("disabled",!0),setTimeout(function(){t(o).prop("disabled",!1)},e)},functionExists:function(n){return"undefined"!=typeof n&&t.isFunction(n)},isEmptyArray:function(t){return this.isEmpty(t)?!0:"undefined"!=typeof t.length?0===t.length:!0},isEmpty:function(n){var e=void 0===n||null===n||"undefined"==typeof n;return e||"null"===t.trim(n)||""===t.trim(n)},isNotEmpty:function(t){return!this.isEmpty(t)},clone:function(n){return t.extend(!0,{},n)},isHidden:function(n){return"none"===t(n).css("display")},position:function(n,e,o){t(n).css({top:e,left:o})},toBoolean:function(t){return this.isEmpty(t)?!1:t===!0||t===!1?t:(t=t.toLowerCase(),"y"===t||"true"===t||"yes"===t||"1"===t)}},vt={idSuffix:"-erf",getEditRowFormId:function(){var t=tt.options.id;return mt.isEmpty(t)&&(t=tt.el.id),mt.isEmpty(t)&&(t="no-id-"+(new Date).getTime()),t+this.idSuffix},getInputId:function(t){var n=at[t].id;return mt.isNotEmpty(n)?n:this.getEditRowFormId()+it+t},getInputName:function(n){var e=at[n].name;if(mt.isNotEmpty(e))return e;if(e=at[n].id,mt.isNotEmpty(e))return e;var o=N(n);return e=t(o).text().trim(),mt.isNotEmpty(e)?e:this.getEditRowFormId()+it+n},getFormCellId:function(t){return this.getEditRowFormId()+"-cell-"+t},getFormRowId:function(){return this.getEditRowFormId()+"-row"},getFormId:function(){return this.getEditRowFormId()+"-form"},getSaveButtonId:function(){return this.getEditRowFormId()+"-save"},getCancelButtonId:function(){return this.getEditRowFormId()+"-cancel"}},yt={createInput:function(n,e,o){var i;return"checkbox"===o?(i=t(ft.checkbox),i.prop("id",n),i.prop("name",e)):"datepicker"===o?(i=t(ft.textfield),i.prop("id",n),i.prop("name",e),t(i).datepicker()):(i=t(ft.textfield),i.prop("id",n),i.prop("name",e)),i},getValue:function(n,e){return"checkbox"===e?this.getCheckboxValue(n):t(n).val()},setValue:function(n,e,o){"checkbox"===e?this.setCheckboxValue(n,o):t(n).val(o)},getCheckboxValue:function(n){return t(n).prop("checked")},setCheckboxValue:function(n,e){t(n).prop("checked",mt.toBoolean(e))}};tt.save=l,tt.addRow=f,tt.deleteRow=h,tt.setRowValues=E,tt.show=g,tt.hide=I,tt.destroy=b,tt.getRowCount=A,tt.getColumnCount=F,tt.getForm=s,t.editrowform.defaultOptions={id:"",cssClass:"",click:!0,saveText:"Save",cancelText:"Cancel",saveButtonTimeout:"",cancelButtonTimeout:"",hideOnBlur:!0,focusOnInput:!1,disableArrowKeys:!1,columns:"",defaultColumn:{colIndex:"",id:"",name:"",type:"",disabled:"",ignore:"",defaultValue:""},onSave:"",onCancel:"",onHide:"",onDeleteRow:"",onAddRow:"",getCellValue:"",setCellValue:"",getInputValue:"",setInputValue:"",renderInput:""},o()}});